@model IEnumerable<SHOPIFY1.Models.MaGiamGium>

@{
    ViewData["Title"] = "Quản lý Mã Giảm Giá";
}

<h2 class="fw-bold mb-4 text-primary"><i class="bi bi-ticket-perforated"></i> Quản lý Mã Giảm Giá</h2>
<p class="text-secondary">Thêm, sửa và quản lý các mã khuyến mãi cho khách hàng.</p>

<hr />

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <a asp-action="Create" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Thêm Mã Giảm Giá
    </a>
    <a asp-controller="Manager" asp-action="Dashboard" class="btn btn-outline-secondary">
        ← Về Dashboard
    </a>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>Mã Code</th>
                <th>Giảm (%)</th>
                <th>Tối đa</th>
                <th>Hiệu lực</th>
                <th>Trạng thái</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                var isExpired = item.NgayKetThuc < DateTime.Now;
                var statusClass = isExpired || item.TrangThai == "Vô hiệu hóa" ? "bg-danger" : "bg-success";

                <tr>
                    <td class="fw-bold text-uppercase">@item.MaCode</td>
                    <td>@item.PhanTramGiam%</td>
                    <td>@string.Format("{0:N0} ₫", item.GiaTriToiDa)</td>
                    <td>@item.NgayBatDau.ToString("dd/MM") - @item.NgayKetThuc.ToString("dd/MM/yyyy")</td>
                    <td>
                        <span class="badge @statusClass">
                            @(isExpired ? "Hết hạn" : item.TrangThai)
                        </span>
                    </td>
                    <td>
                        <a asp-action="Edit" asp-route-id="@item.MaMgg" class="btn btn-sm btn-info text-white me-2" title="Sửa">
                            <i class="bi bi-pencil"></i>
                        </a>

                        <form asp-action="Delete" asp-route-id="@item.MaMgg" method="post" class="d-inline"
                              onsubmit="return confirm('Bạn có chắc chắn muốn vô hiệu hóa Mã Giảm Giá @item.MaCode không?');">
                            <input type="hidden" asp-for="@item.MaMgg" />
                            <button type="submit" class="btn btn-sm btn-danger" title="Vô hiệu hóa"
                                    disabled="@(isExpired || item.TrangThai == "Vô hiệu hóa")">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>